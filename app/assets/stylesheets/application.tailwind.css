@tailwind base;
@tailwind components;
@tailwind utilities;

/* Third-party styles */
@import "@fortawesome/fontawesome-free/css/all.min.css";

/* Custom components/utilities and overrides */

@layer components {
  .btn-primary {
    @apply py-2 px-4 bg-blue-200;
  }

  /* feed styles */

  @media (min-width: 1280px) {
    .feed-container {
      height: calc(100vh - 4rem);
    }
  }

  /* Sidebar collapse styles - prevents FOUC */
  .sidebar-width {
    width: 16rem; /* w-64 - default expanded */
  }

  .sidebar-collapsed .sidebar-width {
    width: 5rem; /* w-20 - collapsed */
  }

  .sidebar-collapsed [data-sidebar-target="text"] {
    display: none;
  }

  /* Main content margin adjustment */
  #main-content {
    margin-left: 0;
  }

  @media (min-width: 1024px) {
    #main-content {
      margin-left: 16rem; /* lg:ml-64 - default */
    }

    .sidebar-collapsed #main-content {
      margin-left: 5rem; /* lg:ml-20 - collapsed */
    }
  }

  /* Toggle collapse styles - prevents FOUC for collapsible sections */

  /* Hide content while initializing to prevent FOUC */
  [data-controller~="toggle"]:not(.toggle-init) {
    visibility: hidden;
  }

  /* Show after initialization */
  [data-controller~="toggle"].toggle-init {
    visibility: visible;
  }

  /* Hide content when collapsed */
  [data-controller~="toggle"].toggle-collapsed [data-toggle-target="content"] {
    display: none;
  }

  /* Override the peer-checked state when parent has toggle-collapsed */
  [data-controller~="toggle"].toggle-collapsed [data-toggle-target="switch"]:checked + div {
    background-color: rgb(156 163 175); /* gray-400 instead of blue-600 */
  }

  [data-controller~="toggle"].toggle-collapsed [data-toggle-target="switch"]:checked + div:after {
    transform: translateX(0); /* Keep slider on left even when checked */
  }

  /* Ensure inline editable display fields keep consistent size even when empty */
  [data-controller~="inline-edit"],
  [data-inline-edit-field-value],
  .inline-display-field {
    @apply min-h-[40px] min-w-[120px];
  }

  /* Add placeholder space when empty so padding renders consistently */
  [data-controller~="inline-edit"]:empty::before,
  [data-inline-edit-field-value]:empty::before,
  .inline-display-field:empty::before {
    content: '\00a0';
  }

  /* Empty state placeholder box for inline-editable cells */
  /* Applied to span elements with inline-edit controller and inline-edit-cell class */
  .inline-edit-cell[data-controller~="inline-edit"].inline-edit-empty,
  span[data-controller~="inline-edit"].inline-edit-empty {
    @apply bg-white border border-gray-300 dark:bg-gray-700 dark:border-gray-600;
    position: relative;
    display: inline-block;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    min-width: 80px;
    min-height: 24px;
  }

  /* For legacy table cells with direct controller (backward compatibility) */
  td[data-controller~="inline-edit"].inline-edit-empty,
  th[data-controller~="inline-edit"].inline-edit-empty {
    display: table-cell;
  }

  /* Inner content wrapper for legacy table cells with empty state */
  td[data-controller~="inline-edit"].inline-edit-empty::after,
  th[data-controller~="inline-edit"].inline-edit-empty::after {
    content: '';
    display: inline-block;
    min-width: 80px;
    min-height: 24px;
    background: white;
    border: 1px solid rgb(209, 213, 219); /* gray-300 */
    border-radius: 0.25rem;
  }

  /* Dark mode for legacy table cell empty state */
  .dark td[data-controller~="inline-edit"].inline-edit-empty::after,
  .dark th[data-controller~="inline-edit"].inline-edit-empty::after {
    background: rgb(55, 65, 81); /* gray-700 */
    border-color: rgb(75, 85, 99); /* gray-600 */
  }

  /* Hover effect on empty cells to indicate they're clickable */
  .inline-edit-cell[data-controller~="inline-edit"].inline-edit-empty:hover,
  span[data-controller~="inline-edit"].inline-edit-empty:hover {
    @apply border-gray-400 dark:border-gray-500;
  }

  /* Hover effect for legacy table cells */
  td[data-controller~="inline-edit"].inline-edit-empty:hover::after,
  th[data-controller~="inline-edit"].inline-edit-empty:hover::after {
    border-color: rgb(156, 163, 175); /* gray-400 */
  }

  .dark td[data-controller~="inline-edit"].inline-edit-empty:hover::after,
  .dark th[data-controller~="inline-edit"].inline-edit-empty:hover::after {
    border-color: rgb(107, 114, 128); /* gray-500 */
  }

  /* Gantt view tweaks */
  .gantt_grid_head_add,
  .gantt_add {
    display: none !important;
  }

  .gantt_task_line.task-red {
    background: #e57373;
    border-color: #d32f2f;
  }

  .gantt_task_progress.task-red {
    background: rgba(0, 0, 0, 0.1);
  }

  .gantt_task_line.task-blue {
    background: #64b5f6;
    border-color: #1976d2;
  }

  .gantt_task_progress.task-blue {
    background: rgba(255, 255, 255, 0.25);
  }

  .gantt_task_line.task-red:hover {
    filter: brightness(0.95);
  }

  .gantt_task_line.task-blue:hover {
    filter: brightness(1.05);
  }

  div[task_id^="t_"] .gantt_cell {
    font-weight: 700;
    color: #6b7280;
  }

  div[task_id^="st_"] .gantt_cell {
    font-weight: 400;
    color: #6b7280;
  }

  /* Drag & drop affordances for tasks/subtasks */
  tr.task-dragging {
    opacity: 0.7;
    transform: scale(1.01) translateY(-2px);
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.12);
    background-color: #f8fafc;
    transition: transform 120ms ease, box-shadow 120ms ease, background-color 120ms ease;
    position: relative;
    z-index: 2;
  }

  tr.task-drag-hover {
    box-shadow: inset 0 3px 0 #3b82f6, inset 0 -3px 0 #3b82f6;
    background-color: #dbeafe;
    transition: background-color 100ms ease, box-shadow 100ms ease;
    border-left: 4px solid #3b82f6;
  }

  tr.task-drop-indicator td {
    padding: 0;
    height: 4px;
    border: 0;
    background: linear-gradient(90deg, #3b82f6, #60a5fa, #3b82f6);
    background-size: 200% 100%;
    animation: shimmer 1.5s ease-in-out infinite;
    box-shadow: 0 0 8px rgba(59, 130, 246, 0.6), 0 0 16px rgba(59, 130, 246, 0.3);
    position: relative;
  }

  tr.task-drop-indicator td::before {
    content: '';
    position: absolute;
    left: 0;
    top: -2px;
    width: 8px;
    height: 8px;
    background: #3b82f6;
    border-radius: 50%;
    box-shadow: 0 0 8px rgba(59, 130, 246, 0.8);
  }

  tr.task-drop-indicator td::after {
    content: '';
    position: absolute;
    right: 0;
    top: -2px;
    width: 8px;
    height: 8px;
    background: #3b82f6;
    border-radius: 50%;
    box-shadow: 0 0 8px rgba(59, 130, 246, 0.8);
  }

  @keyframes shimmer {
    0% {
      background-position: 200% 0;
    }
    100% {
      background-position: -200% 0;
    }
  }
}
