<%= render 'partials/header1', 
           title: @sub_task.name,
           model_name: t('subtasks.form.model_name'),
           search_path: nil,
           new_path: nil,
           additional_crumbs: [
             { name: @project.name, path: business_project_path(@current_business, @project) },
             (@task.persisted? ? { name: @task.name, path: business_project_task_path(@current_business, @project, @task) } : { name: t('tasks.form.new_title'), path: nil }),
             { name: @sub_task.name, path: business_project_task_sub_task_path(@current_business, @project, @task, @sub_task) }
           ] %>
<div class="grid grid-cols-6 gap-6">
  <!-- Name -->
  <div class="col-span-6 sm:col-span-3">
    <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"><%= t('subtasks.form.name') %></label>
    <div class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      <%= @sub_task.name %>
    </div>
  </div>
  <!-- Description -->
  <div class="col-span-6 sm:col-span-3">
    <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"><%= t('subtasks.form.description') %></label>
    <div class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      <%= @sub_task.description %>
    </div>
  </div>
  <div class="col-span-6 sm:col-span-3">
    <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"><%= t('subtasks.form.unit_of_measure') %></label>
    <div class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      <%= @sub_task.unit_of_measure %>
    </div>
  </div>
  <div class="col-span-6 sm:col-span-3">
    <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"><%= t('subtasks.form.quantity') %></label>
    <div class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      <%= @sub_task.quantity %>
    </div>
  </div>
  <div class="col-span-6 sm:col-span-3">
    <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"><%= t('subtasks.form.price_per_unit', currency: @current_business.currency_symbol) %></label>
    <div class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      <%= @sub_task.price_per_unit %>
    </div>
  </div>
  <div class="col-span-6 sm:col-span-3">
    <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"><%= t('subtasks.form.total_cost') %></label>
    <div class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
      <%= @sub_task.total_cost %>
    </div>
  </div>
  <!-- Custom Fields -->
  <div class="col-span-6">
    <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-4"><%= t('subtasks.form.custom_fields') %></h3>
    <% @sub_task.custom_fields.each do |key, value| %>
      <div class="col-span-6 sm:col-span-3">
        <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"><%= key.humanize %></label>
        <div class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white">
          <%= value %>
        </div>
      </div>
    <% end %>
  </div>
</div>
<% 
  model_name = "Resources"
  paths = {
    create_resource: ->(resource) { url_for([:edit, @current_business, resource.activityable]) }, 
    update_resource: ->(resource) { url_for([@current_business, resource.activityable]) }, 
    delete_resource: ->(resource) { url_for([@current_business, resource.activityable]) }
  }
%>
<%= render "partials/table_norms", norms: @norms %>
<div data-controller="subtask"
     data-subtask-id="<%= @sub_task.id %>"
     data-subtask-update-url-value="<%= business_project_task_sub_task_path(@current_business, @project, @task, @sub_task) %>"
     class="grid grid-cols-6 gap-6">
  <div class="col-span-6 sm:col-span-3">
    <label for="duration" class="block mb-2 mt-2 text-sm font-medium text-gray-900 dark:text-white">Duration (days)</label>
    <input type="number" id="duration"
           value="<%= @sub_task.duration %>"
           <%= "disabled" if @sub_task.duration.zero? %>
           class="shadow-sm bg-white border border-gray-300 text-gray-900 sm:text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
           data-subtask-target="duration" data-action="change->subtask#recalculate" />
  </div>
  <div class="col-span-6 sm:col-span-3">
    <label for="skilled" class="block mb-2 mt-2 text-sm font-medium text-gray-900 dark:text-white">Skilled Workers</label>
    <input type="number" id="skilled"
           value="<%= @sub_task.num_workers_skilled %>"
           <%= "disabled" if @sub_task.num_workers_skilled.zero? %>
           class="shadow-sm bg-white border border-gray-300 text-gray-900 sm:text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
           data-subtask-target="skilled" data-action="change->subtask#recalculate" />
  </div>
  <div class="col-span-6 sm:col-span-3">
    <label for="unskilled" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Unskilled Workers</label>
    <input type="number" id="unskilled"
           value="<%= @sub_task.num_workers_unskilled %>"
           <%= "disabled" if @sub_task.num_workers_unskilled.zero? %>
           class="shadow-sm bg-white border border-gray-300 text-gray-900 sm:text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
           data-subtask-target="unskilled" data-action="change->subtask#recalculate" />
  </div>
  <div class="col-span-6 sm:col-span-3">
    <label for="machines" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">Machines</label>
    <input type="number" id="machines"
           value="<%= @sub_task.num_machines %>"
           <%= "disabled" if @sub_task.num_machines.zero? %>
           class="shadow-sm bg-white border border-gray-300 text-gray-900 sm:text-sm rounded-lg block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:text-white"
           data-subtask-target="machines" data-action="change->subtask#recalculate" />
  </div>
</div>
<%= render 'partials/table', 
           collection: @activities, 
           columns: {
             t('tasks.form.name') => ->(activity) { activity.activityable.name }, 
             t('tasks.form.type') => ->(activity) { activity.activity_type }, 
             t('tasks.form.description') => ->(activity) { activity.activityable.description }, 
             t('tasks.form.planned_start_date') => ->(activity) { activity.start_date.strftime("%d.%m.%Y") },
             t('tasks.form.quantity') => ->(activity) { activity.quantity }, 
             t('tasks.form.unit_of_measure') => ->(activity) { activity.activityable.unit_of_measure }, 
             t('tasks.form.price_per_unit') => ->(activity) { activity.activityable.price_per_unit }, 
             t('tasks.form.total_cost') => ->(activity) { activity.total_cost }, 
           },
           turbo_frame_id: "resources-frame",
           model_name: model_name, 
           edit_path: "",
           show_path: "",
           delete_path: "",
           actions: [] %>
<%= render "modals/modal_resource" %>
<% 
  model_name = "Documents"
  paths_doc = {
    new_document: new_business_project_document_path(@current_business, @project, @task, @sub_task),
    edit_document: ->(document) { "" },
    show_document: ->(document) { "" },
    delete_document: ->(document) { business_project_document_path(@current_business, @project, document) }
  }
%>
<%= render 'partials/table', 
           collection: @documents, 
           columns: {
             t('documents.form.name') => :name, 
             t('documents.form.description') => ->(document) { content_tag(:span, document.description&.truncate(25), title: document.description, class: "tooltip") },
             t('documents.form.category') => ->(document) { document.category.humanize }, 
             t('documents.form.size') => ->(document) { document.file.attached? ? "#{document.file.byte_size / 1024} KB" : t('documents.form.no_file') },
             t('documents.form.created_at') => ->(document) { document.created_at.strftime("%Y-%m-%d") }
           },
           turbo_frame_id: "documents-frame",
           model_name: model_name, 
           search_path: paths_doc[:documents], 
           new_path: paths_doc[:new_document],
           edit_path: paths_doc[:edit_document],
           show_path: paths_doc[:show_document],
           delete_path: paths_doc[:delete_document],
           actions: [] %>
<%= render "modals/modal_documents" %>