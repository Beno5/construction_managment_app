<%
  # Build status options for inline editing with blank option
  status_options = { "" => "" }.merge(
    Project.statuses.keys.each_with_object({}) do |key, hash|
      hash[key] = I18n.t("activerecord.attributes.project.statuses.#{key}")
    end
  )
%>
<div id="row_<%= project.id %>"
     class="w-full h-full flex flex-col justify-between p-4 mb-4 bg-white border border-gray-200 rounded-lg shadow-sm
            dark:border-gray-700 sm:p-6 dark:bg-gray-800"
     data-controller="<%= local_assigns[:highlight] ? 'highlight toast' : 'toast' %>"
     <% if local_assigns[:highlight] %>
       data-highlight-duration-value="5000"
     <% end %>>
  <!-- Header -->
  <div class="flex justify-between items-center px-4 py-2">
    <h2 class="text-xl font-bold"><%= t('projects.form.name') %>:
      <span class="inline-block cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-1 rounded min-w-[100px] min-h-[28px]"
            data-controller="inline-edit"
            data-inline-edit-model-value="project"
            data-inline-edit-field-value="name"
            data-inline-edit-type-value="text"
            data-inline-edit-url-value="<%= business_project_path(@current_business, project) %>"
            data-inline-edit-original-value="<%= project.name %>"
            data-inline-edit-record-updated-at-value="<%= project.updated_at.iso8601 %>"
            data-inline-edit-required-value="true"
            data-action="click->inline-edit#activate"
            title="<%= t('tooltips.click_to_edit') %>">
        <%= project.name %>
      </span>
    </h2>
    <span class="text-sm font-semibold text-gray-600 dark:text-gray-400"><%= t('projects.form.task_count') %>: <%= project.tasks.count %></span>
  </div>
  <!-- Project Parameters -->
  <div class="flex flex-col space-y-2 px-4 py-2 text-gray-700 dark:text-gray-300">
    <p>
      <span class="font-semibold"><%= t('projects.form.address') %>:</span>
      <span data-controller="inline-edit"
            data-inline-edit-model-value="project"
            data-inline-edit-field-value="address"
            data-inline-edit-type-value="text"
            data-inline-edit-url-value="<%= business_project_path(@current_business, project) %>"
            data-inline-edit-original-value="<%= project.address %>"
            data-inline-edit-record-updated-at-value="<%= project.updated_at.iso8601 %>"
            data-action="click->inline-edit#activate"
            class="cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-1 rounded inline-block min-w-[100px] min-h-[24px]"
            title="<%= t('tooltips.click_to_edit') %>">
        <%= project.address.presence || t('projects.form.not_available') %>
      </span>
    </p>
    <p>
      <span class="font-semibold"><%= t('projects.form.project_manager') %>:</span>
      <span data-controller="inline-edit"
            data-inline-edit-model-value="project"
            data-inline-edit-field-value="project_manager"
            data-inline-edit-type-value="text"
            data-inline-edit-url-value="<%= business_project_path(@current_business, project) %>"
            data-inline-edit-original-value="<%= project.project_manager %>"
            data-inline-edit-record-updated-at-value="<%= project.updated_at.iso8601 %>"
            data-action="click->inline-edit#activate"
            class="cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-1 rounded inline-block min-w-[100px] min-h-[24px]"
            title="<%= t('tooltips.click_to_edit') %>">
        <%= project.project_manager.presence || t('projects.form.not_available') %>
      </span>
    </p>
    <p>
      <span class="font-semibold"><%= t('projects.form.planned_start_date') %>:</span>
      <span data-controller="inline-edit"
            data-inline-edit-model-value="project"
            data-inline-edit-field-value="planned_start_date"
            data-inline-edit-type-value="date"
            data-inline-edit-url-value="<%= business_project_path(@current_business, project) %>"
            data-inline-edit-original-value="<%= project.planned_start_date %>"
            data-inline-edit-record-updated-at-value="<%= project.updated_at.iso8601 %>"
            data-inline-edit-disabled-value="<%= project.tasks.exists? %>"
            data-inline-edit-disabled-message-value="<%= t('projects.inline_edit.locked_due_to_tasks') %>"
            data-action="click->inline-edit#activate"
            class="px-1 rounded inline-block min-w-[100px] min-h-[24px] <%= project.tasks.exists? ? 'cursor-not-allowed text-gray-500 dark:text-gray-400' : 'cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700' %>"
            title="<%= project.tasks.exists? ? t('projects.inline_edit.locked_due_to_tasks') : t('tooltips.click_to_edit') %>">
        <%= project.planned_start_date ? l(project.planned_start_date) : t('projects.form.not_available') %>
      </span>
    </p>
    <p>
      <span class="font-semibold"><%= t('projects.form.planned_end_date') %>:</span>
      <span data-controller="inline-edit"
            data-inline-edit-model-value="project"
            data-inline-edit-field-value="planned_end_date"
            data-inline-edit-type-value="date"
            data-inline-edit-url-value="<%= business_project_path(@current_business, project) %>"
            data-inline-edit-original-value="<%= project.planned_end_date %>"
            data-inline-edit-record-updated-at-value="<%= project.updated_at.iso8601 %>"
            data-inline-edit-disabled-value="<%= project.tasks.exists? %>"
            data-inline-edit-disabled-message-value="<%= t('projects.inline_edit.locked_due_to_tasks') %>"
            data-action="click->inline-edit#activate"
            class="px-1 rounded inline-block min-w-[100px] min-h-[24px] <%= project.tasks.exists? ? 'cursor-not-allowed text-gray-500 dark:text-gray-400' : 'cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700' %>"
            title="<%= project.tasks.exists? ? t('projects.inline_edit.locked_due_to_tasks') : t('tooltips.click_to_edit') %>">
        <%= project.planned_end_date ? l(project.planned_end_date) : t('projects.form.not_available') %>
      </span>
    </p>
    <p>
      <span class="font-semibold"><%= t('projects.form.planned_cost', currency: project.business.currency_symbol) %>:</span>
      <span data-controller="inline-edit"
            data-inline-edit-model-value="project"
            data-inline-edit-field-value="planned_cost"
            data-inline-edit-type-value="number"
            data-inline-edit-url-value="<%= business_project_path(@current_business, project) %>"
            data-inline-edit-original-value="<%= project.planned_cost %>"
            data-inline-edit-record-updated-at-value="<%= project.updated_at.iso8601 %>"
            data-inline-edit-disabled-value="<%= project.tasks.exists? %>"
            data-inline-edit-disabled-message-value="<%= t('projects.inline_edit.locked_due_to_tasks') %>"
            data-action="click->inline-edit#activate"
            class="px-1 rounded inline-block min-w-[100px] min-h-[24px] <%= project.tasks.exists? ? 'cursor-not-allowed text-gray-500 dark:text-gray-400' : 'cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700' %>"
            title="<%= project.tasks.exists? ? t('projects.inline_edit.locked_due_to_tasks') : t('tooltips.click_to_edit') %>">
        <%= project.planned_cost ? "#{project.planned_cost} #{project.business.currency_symbol}" : t('projects.form.not_available') %>
      </span>
    </p>
    <p>
      <span class="font-semibold"><%= t('projects.form.planned_cost_from_resources', currency: project.business.currency_symbol) %>:</span>
      <span class="px-1 rounded inline-block min-w-[100px] min-h-[24px] text-gray-600 dark:text-gray-400">
        <%= project.planned_cost_from_resources ? "#{number_with_precision(project.planned_cost_from_resources, precision: 2)} #{project.business.currency_symbol}" : "0.00 #{project.business.currency_symbol}" %>
      </span>
    </p>
    <p>
      <span class="font-semibold"><%= t('projects.form.status') %>:</span>
      <span data-controller="inline-edit"
            data-inline-edit-model-value="project"
            data-inline-edit-field-value="status"
            data-inline-edit-type-value="select"
            data-inline-edit-url-value="<%= business_project_path(@current_business, project) %>"
            data-inline-edit-original-value="<%= project.status %>"
            data-inline-edit-record-updated-at-value="<%= project.updated_at.iso8601 %>"
            data-inline-edit-options-value='<%= status_options.to_json %>'
            data-action="click->inline-edit#activate"
            class="cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-1 rounded inline-block min-w-[100px] min-h-[24px]"
            title="<%= t('tooltips.click_to_edit') %>">
        <%= I18n.t("activerecord.attributes.project.statuses.#{project.status}", default: project.status.humanize) %>
      </span>
    </p>
    <p>
      <span class="font-semibold"><%= t('projects.form.description') %>:</span>
      <span data-controller="inline-edit"
            data-inline-edit-model-value="project"
            data-inline-edit-field-value="description"
            data-inline-edit-type-value="textarea"
            data-inline-edit-url-value="<%= business_project_path(@current_business, project) %>"
            data-inline-edit-original-value="<%= project.description %>"
            data-inline-edit-record-updated-at-value="<%= project.updated_at.iso8601 %>"
            data-action="click->inline-edit#activate"
            class="cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-700 px-1 rounded block mt-1 min-w-[100px] min-h-[24px]"
            title="<%= t('tooltips.click_to_edit') %>">
        <%= project.description.present? ? truncate(project.description, length: 100) : t('projects.form.not_available') %>
      </span>
    </p>
  </div>
  <!-- Actions -->
  <div class="flex flex-wrap justify-evenly gap-3 gap-y-3 px-4 py-4">
    <!-- Add Task -->
    <%= link_to new_business_project_task_path(project.business, project),
            class: "min-w-[200px] inline-flex items-center justify-center text-center bg-primary-600 text-white px-4 py-2 rounded-lg hover:bg-primary-700 focus:ring-4 focus:ring-primary-300 transition",
            data: { turbo: false } do %>
      <svg class="w-5 h-5 mr-2 text-white" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd"></path>
      </svg>
      <%= t('projects.form.add_task') %>
    <% end %>
    <!-- View Project -->
    <%= link_to business_project_path(project.business, project),
              class: "min-w-[200px] text-center bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 focus:ring-4 focus:ring-gray-300 transition",
              data: { turbo: false } do %>
      ğŸ“‹ <%= t('projects.form.view_project') %>
    <% end %>
    <!-- Edit Project -->
    <%= link_to edit_business_project_path(project.business, project),
              class: "min-w-[200px] text-center  bg-gray-200 text-gray-900 px-4 py-2 rounded-lg  hover:bg-gray-300 focus:ring-4 focus:ring-yellow-300 transition",
              data: { turbo: false } do %>
      âœï¸ <%= t('projects.form.edit_project') %>
    <% end %>
    <!-- Delete Project -->
    <%= link_to business_project_path(project.business, project),
              data: { turbo_method: :delete, turbo_confirm: t('confirmations.delete', name: project.name) },
              class: "min-w-[200px] text-center bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 focus:ring-4 focus:ring-red-300 transition" do %>
      ğŸ—‘ï¸ <%= t('projects.form.delete_project') %>
    <% end %>
  </div>
</div>
