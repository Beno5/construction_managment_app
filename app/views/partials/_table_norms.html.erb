<section class="bg-gray-50 dark:bg-gray-900 pt-5">
  <div class="mx-auto">
    <div class="bg-white dark:bg-gray-800 relative shadow-md sm:rounded-lg overflow">
      <div class="flex flex-col md:flex-row items-center justify-between space-y-3 md:space-y-0 md:space-x-4 p-4">
        <div class="w-full md:w-1/2">
          <h2 class="text-l font-semibold text-gray-900 sm:text-2xl dark:text-white mb-4"><%= t("norms.title") %></h2>

          <%= form_with url: norms_path, method: :get, data: { turbo_frame: "norms-frame", controller: "search" }, local: true do %>
  <%= hidden_field_tag :sub_task_id, @sub_task.id if @sub_task.present? %>
  <label for="search" class="sr-only">Search</label>
  <div class="relative mt-1 lg:w-64 xl:w-96">
    <input type="text" 
           name="search" 
           id="search" 
           placeholder="PretraÅ¾i norme..."
           value="<%= params[:search] %>"
           <%= "disabled" if @sub_task.new_record? %>
           class="bg-gray-50 border border-gray-300 text-gray-900 sm:text-sm rounded-lg 
                  block w-full p-2.5 
                  dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white
                  <%= @sub_task.new_record? ? 'cursor-not-allowed bg-gray-200 dark:bg-gray-600' : 'focus:ring-primary-500 focus:border-primary-500 dark:focus:ring-primary-500 dark:focus:border-primary-500' %>"
           data-action="<%= 'input->search#performSearch' unless @sub_task.new_record? %>">
  </div>
<% end %>

        </div>
      </div>
      <turbo-frame id="norms-frame">
        <div class="overflow-x-auto"
       data-controller="norms"
       data-norms-subtask-id-value="<%= @sub_task.id %>">
          <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
            <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
              <tr>
                <th scope="col" class="px-4 py-3">
                </th>
                <th scope="col" class="px-4 py-3"><%= t('norms.form.name') %></th>
                <th scope="col" class="px-4 py-3"><%= t('norms.form.description') %></th>
                <th scope="col" class="px-4 py-3"><%= t('norms.form.norm_value') %></th>
                <th scope="col" class="px-4 py-3"><%= t('norms.form.norm_type') %></th>
                <th scope="col" class="px-4 py-3"><%= t('norms.form.subtype') %></th>
                <th scope="col" class="px-4 py-3"><%= t('norms.form.unit_of_measure') %></th>
                <th scope="col" class="px-4 py-3"><%= t('norms.form.info') %></th>
              </tr>
            </thead>
            <tbody>
              <% @norms&.each do |norm| %>
                <tr class="border-b dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700">
                  <td class="px-4 py-3">
                    <%= check_box_tag "selected_norm_ids[]", norm.id, @pinned_norms.include?(norm),
                        class: "norm-checkbox",
                        disabled: norm_disabled?(norm, @pinned_norms) || norm_disabled_by_unit?(norm, @pinned_norms),
                        data: {
                          action: "change->norms#trackSelection",
                          norm_type: norm.norm_type,
                          norm_subtype: norm.worker? ? norm.subtype : nil,
                          norm_unit: norm.unit_of_measure
                        }.compact %>

                  </td>
                  <td class="px-4 py-3"><%= norm.name %></td>
                  <td class="px-4 py-3"><%= norm.description&.truncate(50) %></td>
                  <td class="px-4 py-3"><%= norm.norm_value %></td>
                  <td class="px-4 py-3"><%= norm.norm_type.humanize %></td>
                  <td class="px-4 py-3"><%= norm.subtype&.humanize || '-' %></td>
                  <td class="px-4 py-3"><%= norm.unit_of_measure %></td>
                  <td class="px-4 py-3"><%= norm.info %></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </turbo-frame>
    </div>
  </div>
</section>
